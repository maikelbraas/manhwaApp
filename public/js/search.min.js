const search=document.getElementById('search');const manhwasElement=document.getElementById('manhwas-search');const template=document.getElementById('manhwa-card-template');const containerManhwa=document.querySelector('.manhwa-search-container');const checkGenre=document.getElementById('genre-check');const searchContainer=document.getElementById('search-container');let page;let active=0;let searchValInter;const spinner=document.querySelector('.loading-spinner');searchManhwa();let manhwas=JSON.parse(localStorage.getItem('manhwas'));checkGenre.addEventListener('click',()=>{if(checkGenre.checked){search.setAttribute('placeholder','Ex. action adventure sci...')}else{search.setAttribute('placeholder','Ex. Solo Leveling')}})
    search.addEventListener('input',searchManhwa);search.addEventListener('focus',()=>{searchContainer.style.width='100%';searchContainer.style.backgroundColor='#212529';if(isUserUsingMobile())searchContainer.style.right='0';
    searchContainer.classList.remove('active')})
    search.addEventListener('blur',(event)=>{searchContainer.style.width='240px';searchContainer.style.right='75px';searchContainer.classList.add('active');}); window.addEventListener('click', (event) => {if(!event.target.closest('.manhwa-search-container') && (search.value != '' || document.querySelector('.manhwa-search-container').style.display == 'flex')){ search.value = ''; searchManhwa(); event.preventDefault()}})
    function searchManhwa(){manhwasElement.innerHTML="";if(search.value.length>0){manhwasElement.style.display='flex';containerManhwa.style.display='flex';createCard()}else{manhwasElement.style.display='none';containerManhwa.style.display='none'}}
    function createCard(){let searchv=search.value.toUpperCase();spinner.style.display="flex";for(let i=0;i<manhwas.length;i++){if(checkGenre.checked){let genres=searchv.toLowerCase().replace('genre','').split(' ');if(genres.length>0&&manhwas[i].genres!=null&&genres.every((genre)=>manhwas[i].genres.toLowerCase().includes(genre))){card(manhwas[i])}}else if(manhwas[i].title.toUpperCase().indexOf(searchv)>-1){card(manhwas[i])}
    if(i==manhwas.length-1){spinner.style.display="none"}}}
    function card(manhwa){let clone=template.content.cloneNode(!0);clone.querySelector('.card-link').href+=manhwa.mid;clone.querySelector('.card-title').innerHTML=manhwa.title;clone.querySelector('.rounded-start').dataset.src="/manhwaImages/"+manhwa.mid+"-100x150.webp";clone.querySelector('.card-status').innerHTML+=" "+manhwa.status+` <i class="${manhwa.status.toLowerCase().replace(/\s/g, "")}" >&#9679;</i> `;let chapters=manhwa.chapters%1!==0?manhwa.chapters.toFixed(1):manhwa.chapters;clone.querySelector('.card-chapter').textContent+=" "+chapters;let genreContainers=clone.querySelectorAll('.genres-manhwa');let genrePart=clone.querySelector('.me-1').cloneNode(!0);for(let genreContainer of genreContainers)
    genreContainer.innerHTML="";if(manhwa.genres!=null){for(let genre of manhwa.genres.split(',')){for(let genreContainer of genreContainers){genrePart.querySelector('.fa-fist-raised').textContent=genre;genreContainer.appendChild(genrePart)
    genrePart=clone.querySelector('.me-1').cloneNode(!0)}}}
    manhwasElement.appendChild(clone)}

function isUserUsingMobile() {
    let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent); if (!isMobile) { let screenWidth = window.screen.width; let screenHeight = window.screen.height; isMobile = (screenWidth < 768 || screenHeight < 768) }
    if (!isMobile) { isMobile = (('ontouchstart' in window) || (navigator.maxTouchPoints > 0) || (navigator.msMaxTouchPoints > 0)) }
    if (!isMobile) { let bodyElement = document.getElementsByTagName('body')[0]; isMobile = window.getComputedStyle(bodyElement).getPropertyValue('content').indexOf('mobile') !== -1 }
    return isMobile
}